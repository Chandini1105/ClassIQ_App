{% extends 'base.html' %}

{% block content %}
<script>
    setTimeout(function () {
        window.location.reload();
    }, 60000);
</script>

<div class="page-header">
    <h1>📊 Dashboard</h1>
    <p class="subtitle">Overview of classroom usage and availability</p>
</div>

<!-- College Hours & Current Status -->
<div style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; border-radius: 12px; padding: 24px; margin-bottom: 28px; box-shadow: 0 8px 24px rgba(102, 126, 234, 0.3);">
    <div style="display: flex; gap: 30px;">
        <div>
            <p style="margin: 0 0 6px 0; font-size: 13px; opacity: 0.9;"><strong>College Hours:</strong></p>
            <p style="margin: 0; font-size: 18px; font-weight: 700;">{{ school_start|date:"g:i A" }} - {{ school_end|date:"g:i A" }}</p>
        </div>
        <div>
            <p style="margin: 0 0 6px 0; font-size: 13px; opacity: 0.9;"><strong>Current Time (IST):</strong></p>
            <p style="margin: 0; font-size: 18px; font-weight: 700;">{{ current_time|date:"g:i A" }}</p>
        </div>
    </div>
</div>

<!-- Stats Cards -->
<div class="cards">

    <div class="card card-blue">
        <div class="card-icon">👨‍🎓</div>
        <h3>Active Classes</h3>
        <p class="card-value">{{ active_count }}</p>
        <small>Classes currently running</small>
    </div>

    <div class="card card-green">
        <div class="card-icon">🏫</div>
        <h3>Available Classrooms</h3>
        <p class="card-value">{{ available_count }}</p>
        <small>Rooms free right now</small>
    </div>

</div>

<!-- ACTIVE CLASSES SECTION -->
<div class="section">
    <h2>👁️ Active Classes (Right Now)</h2>

    {% if ongoing_classes %}
    <table class="data-table">
        <thead>
            <tr>
                <th>Course</th>
                <th>Faculty</th>
                <th>Classroom</th>
                <th>Time</th>
                <th>Student Leader</th>
            </tr>
        </thead>
        <tbody>
            {% for alloc in ongoing_classes %}
            <tr>
                <td>{{ alloc.course }}</td>
                <td>{{ alloc.course.faculty.name }}</td>
                <td><strong>{{ alloc.classroom }}</strong></td>
                <td>{{ alloc.start_time|date:"g:i A" }} – {{ alloc.end_time|date:"g:i A" }}</td>
                <td>
                    {% if alloc.student_leader %}
                        {{ alloc.student_leader.name }}
                    {% else %}
                        —
                    {% endif %}
                </td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
    {% else %}
        <p class="empty-message">No active classes right now</p>
    {% endif %}
</div>

<!-- UPCOMING CLASSES SECTION -->
<div class="section">
    <h2>⏰ Upcoming Classes (Today)</h2>

    {% if upcoming_classes %}
    <table class="data-table">
        <thead>
            <tr>
                <th>Course</th>
                <th>Faculty</th>
                <th>Classroom</th>
                <th>Start Time</th>
                <th>Duration</th>
                <th>Student Leader</th>
            </tr>
        </thead>
        <tbody>
            {% for alloc in upcoming_classes %}
            <tr>
                <td>{{ alloc.course }}</td>
                <td>{{ alloc.course.faculty.name }}</td>
                <td><strong>{{ alloc.classroom }}</strong></td>
                <td>{{ alloc.start_time|date:"g:i A" }}</td>
                <td>{{ alloc.duration_minutes }} min</td>
                <td>
                    {% if alloc.student_leader %}
                        {{ alloc.student_leader.name }}
                    {% else %}
                        —
                    {% endif %}
                </td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
    {% else %}
        <p class="empty-message">No upcoming classes today</p>
    {% endif %}
</div>
  
<!-- AVAILABLE CLASSROOMS RIGHT NOW -->
<div class="section">
    <h2>✅ Classroom Availability (Right Now)</h2>

    {% if classroom_status %}
    <div class="classroom-grid">
        {% for item in classroom_status %}
        <div class="classroom-card {% if item.is_available %}available{% else %}unavailable{% endif %}">
            <div class="room-number">{{ item.room.room_number }}</div>
            <p class="capacity">👥 Capacity: {{ item.room.capacity }}</p>
            {% if item.is_available %}
                <p class="status-available">✓ Available Now</p>
            {% else %}
                <p class="status-unavailable">✗ Booked Now</p>
            {% endif %}
        </div>
        {% endfor %}
    </div>
    {% else %}
        <p class="empty-message">No classrooms available</p>
    {% endif %}
</div>

<!-- BOOKED CLASSROOMS TODAY -->
<div class="section">
    <h2>📅 Booked Classrooms (Today)</h2>

    {% if all_allocations %}
    <table class="data-table">
        <thead>
            <tr>
                <th>Classroom</th>
                <th>Course</th>
                <th>Faculty</th>
                <th>Time</th>
                <th>Duration</th>
                <th>Student Leader</th>
                <th>Status</th>
            </tr>
        </thead>
        <tbody>
            {% for alloc in all_allocations %}
            <tr>
                <td><strong>{{ alloc.classroom }}</strong></td>
                <td>{{ alloc.course }}</td>
                <td>{{ alloc.course.faculty.name }}</td>
                <td>{{ alloc.start_time|date:"g:i A" }} – {{ alloc.end_time|date:"g:i A" }}</td>
                <td>{{ alloc.duration_minutes }} min</td>
                <td>
                    {% if alloc.student_leader %}
                        {{ alloc.student_leader.name }}
                    {% else %}
                        —
                    {% endif %}
                </td>
                <td>
                    {% if alloc in ongoing_classes %}
                        <span class="status active">Active</span>
                    {% elif alloc in upcoming_classes %}
                        <span class="status upcoming">Upcoming</span>
                    {% else %}
                        <span class="status">Completed</span>
                    {% endif %}
                </td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
    {% else %}
        <p class="empty-message">No classrooms booked today</p>
    {% endif %}

</div>

<style>
    .empty-message {
        color: var(--muted);
        text-align: center;
        padding: 20px;
        font-style: italic;
    }
    
    .status {
        padding: 6px 10px;
        border-radius: 14px;
        font-size: 13px;
        font-weight: 700;
        display: inline-block;
    }
    
    .status.active {
        background: #fee2e2;
        color: #991b1b;
    }
    
    .status.upcoming {
        background: #fef3c7;
        color: #92400e;
    }

    /* Card Styles */
    .card {
        background: white;
        padding: 24px;
        border-radius: 12px;
        border-left: 5px solid;
        box-shadow: 0 6px 18px rgba(15,23,36,0.08);
        transition: all 0.3s ease;
    }

    .card:hover {
        transform: translateY(-4px);
        box-shadow: 0 10px 28px rgba(15,23,36,0.12);
    }

    .card-blue {
        border-left-color: #0b5fff;
        background: linear-gradient(135deg, rgba(11, 95, 255, 0.05) 0%, rgba(11, 95, 255, 0.02) 100%);
    }

    .card-green {
        border-left-color: #10b981;
        background: linear-gradient(135deg, rgba(16, 185, 129, 0.05) 0%, rgba(16, 185, 129, 0.02) 100%);
    }

    .card-icon {
        font-size: 32px;
        margin-bottom: 12px;
    }

    .card h3 {
        color: #6b7280;
        font-size: 14px;
        margin: 0 0 10px 0;
        font-weight: 600;
        text-transform: uppercase;
        letter-spacing: 0.5px;
    }

    .card-value {
        font-size: 36px;
        font-weight: 700;
        color: #0f1724;
        margin: 0 0 8px 0;
    }

    .card small {
        color: #6b7280;
        font-size: 13px;
    }
    
    .classroom-grid {
        display: grid;
        grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
        gap: 18px;
        margin-top: 20px;
    }
    
    .classroom-card {
        background: white;
        border-radius: 12px;
        padding: 20px;
        text-align: center;
        box-shadow: 0 4px 12px rgba(15,23,36,0.06);
        border: 2px solid #e5e7eb;
        border-top: 4px solid #10b981;
        transition: all 0.3s ease;
    }

    .classroom-card:hover {
        transform: translateY(-4px);
        box-shadow: 0 10px 24px rgba(16, 185, 129, 0.15);
        border-top-color: #059669;
    }
    
    .classroom-card.available {
        border-top-color: #10b981;
    }
    
    .classroom-card.available:hover {
        box-shadow: 0 10px 24px rgba(16, 185, 129, 0.15);
        border-top-color: #059669;
    }
    
    .classroom-card.unavailable {
        border-top-color: #ef4444;
        background: linear-gradient(135deg, rgba(239, 68, 68, 0.03) 0%, rgba(239, 68, 68, 0.01) 100%);
    }
    
    .classroom-card.unavailable:hover {
        box-shadow: 0 10px 24px rgba(239, 68, 68, 0.15);
        border-top-color: #dc2626;
    }
    
    .classroom-card .room-number {
        margin: 0 0 12px 0;
        color: #0f1724;
        font-size: 24px;
        font-weight: 700;
    }
    
    .classroom-card .capacity {
        margin: 0 0 12px 0;
        color: #6b7280;
        font-size: 14px;
    }
    
    .classroom-card .status-available {
        margin: 0;
        color: #10b981;
        font-weight: 700;
        font-size: 14px;
    }
    
    .classroom-card .status-unavailable {
        margin: 0;
        color: #ef4444;
        font-weight: 700;
        font-size: 14px;
    }
</style>
{% endblock %}
